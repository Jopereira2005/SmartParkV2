{% extends "client_backoffice/base.html" %}

{% block page_title %}Dashboard{% endblock %}

{% block content %}
<div class="row g-4 mb-4">
  <!-- Cards de estatísticas -->
  <div class="col-xl-3 col-md-6">
    <div class="stat-card">
      <div
        class="stat-icon"
        style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); color: #1e40af;"
      >
        <i class="fas fa-building"></i>
      </div>
      <div class="stat-value" id="totalEstablishments">8</div>
      <div class="stat-label">Total de Estabelecimentos</div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6">
    <div class="stat-card">
      <div
        class="stat-icon"
        style="background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); color: #15803d;"
      >
        <i class="fas fa-car"></i>
      </div>
      <div class="stat-value" id="totalParkingLots">24</div>
      <div class="stat-label">Estacionamentos Ativos</div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6">
    <div class="stat-card">
      <div
        class="stat-icon"
        style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); color: #d97706;"
      >
        <i class="fas fa-square-parking"></i>
      </div>
      <div class="stat-value" id="totalSpaces">1,248</div>
      <div class="stat-label">Total de Vagas</div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6">
    <div class="stat-card">
      <div
        class="stat-icon"
        style="background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); color: #dc2626;"
      >
        <i class="fas fa-chart-line"></i>
      </div>
      <div class="stat-value" id="occupancyRate">73%</div>
      <div class="stat-label">Taxa de Ocupação</div>
    </div>
  </div>
</div>

<div class="row g-4 mb-4">
  <!-- Gráfico de ocupação em tempo real -->
  <div class="col-xl-8">
    <div class="stat-card">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h5 class="mb-0 fw-bold">Ocupação em Tempo Real</h5>
        <div class="d-flex align-items-center gap-2">
          <span class="badge bg-success">Atualizado agora</span>
          <i class="fas fa-sync-alt text-success" id="refreshIcon"></i>
        </div>
      </div>
      <canvas id="occupancyChart" style="max-height: 300px;"></canvas>
    </div>
  </div>

  <!-- Status dos estacionamentos -->
  <div class="col-xl-4">
    <div class="stat-card">
      <h5 class="mb-4 fw-bold">Status dos Estacionamentos</h5>

      <div class="mb-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <span class="fw-medium">Shopping Center Norte</span>
          <span class="badge bg-success">Online</span>
        </div>
        <div class="progress" style="height: 8px;">
          <div class="progress-bar bg-success" style="width: 85%"></div>
        </div>
        <small class="text-muted">340/400 vagas ocupadas</small>
      </div>

      <div class="mb-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <span class="fw-medium">Edifício Comercial</span>
          <span class="badge bg-warning">Parcial</span>
        </div>
        <div class="progress" style="height: 8px;">
          <div class="progress-bar bg-warning" style="width: 65%"></div>
        </div>
        <small class="text-muted">130/200 vagas ocupadas</small>
      </div>

      <div class="mb-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <span class="fw-medium">Hospital Regional</span>
          <span class="badge bg-success">Online</span>
        </div>
        <div class="progress" style="height: 8px;">
          <div class="progress-bar bg-success" style="width: 92%"></div>
        </div>
        <small class="text-muted">276/300 vagas ocupadas</small>
      </div>

      <div class="mb-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <span class="fw-medium">Universidade Central</span>
          <span class="badge bg-danger">Offline</span>
        </div>
        <div class="progress" style="height: 8px;">
          <div class="progress-bar bg-secondary" style="width: 0%"></div>
        </div>
        <small class="text-muted">Sistema temporariamente indisponível</small>
      </div>
    </div>
  </div>
</div>

<div class="row g-4 mb-4">
  <!-- Receita mensal -->
  <div class="col-xl-6">
    <div class="stat-card">
      <h5 class="mb-4 fw-bold">Receita Mensal</h5>
      <canvas id="revenueChart" style="max-height: 250px;"></canvas>
    </div>
  </div>

  <!-- Alertas e notificações -->
  <div class="col-xl-6">
    <div class="stat-card">
      <h5 class="mb-4 fw-bold">Alertas e Notificações</h5>

      <div class="list-group list-group-flush">
        <div class="list-group-item d-flex align-items-center border-0 px-0">
          <div class="me-3">
            <div
              class="rounded-circle bg-warning d-flex align-items-center justify-content-center"
              style="width: 40px; height: 40px;"
            >
              <i class="fas fa-exclamation-triangle text-white"></i>
            </div>
          </div>
          <div class="flex-grow-1">
            <h6 class="mb-1">Camera offline - Setor B</h6>
            <small class="text-muted">Shopping Center Norte • há 15 min</small>
          </div>
        </div>

        <div class="list-group-item d-flex align-items-center border-0 px-0">
          <div class="me-3">
            <div
              class="rounded-circle bg-success d-flex align-items-center justify-content-center"
              style="width: 40px; height: 40px;"
            >
              <i class="fas fa-check text-white"></i>
            </div>
          </div>
          <div class="flex-grow-1">
            <h6 class="mb-1">Manutenção concluída</h6>
            <small class="text-muted">Hospital Regional • há 2 horas</small>
          </div>
        </div>

        <div class="list-group-item d-flex align-items-center border-0 px-0">
          <div class="me-3">
            <div
              class="rounded-circle bg-info d-flex align-items-center justify-content-center"
              style="width: 40px; height: 40px;"
            >
              <i class="fas fa-info text-white"></i>
            </div>
          </div>
          <div class="flex-grow-1">
            <h6 class="mb-1">Pico de ocupação atingido</h6>
            <small class="text-muted">Edifício Comercial • há 4 horas</small>
          </div>
        </div>

        <div class="list-group-item d-flex align-items-center border-0 px-0">
          <div class="me-3">
            <div
              class="rounded-circle bg-danger d-flex align-items-center justify-content-center"
              style="width: 40px; height: 40px;"
            >
              <i class="fas fa-times text-white"></i>
            </div>
          </div>
          <div class="flex-grow-1">
            <h6 class="mb-1">Sistema offline</h6>
            <small class="text-muted">Universidade Central • há 6 horas</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Gráfico de ocupação em tempo real
const occupancyCtx = document.getElementById('occupancyChart').getContext('2d');
const occupancyChart = new Chart(occupancyCtx, {
  type: 'line',
  data: {
    labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', '23:59'],
    datasets: [{
      label: 'Taxa de Ocupação (%)',
      data: [15, 8, 45, 78, 85, 72, 35],
      borderColor: '#1e40af',
      backgroundColor: 'rgba(30, 64, 175, 0.1)',
      borderWidth: 3,
      fill: true,
      tension: 0.4
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: { display: false }
    },
    scales: {
      y: {
        beginAtZero: true,
        max: 100,
        ticks: {
          callback: function (value) {
            return value + '%';
          }
        }
      }
    }
  }
});

// Gráfico de receita mensal
const revenueCtx = document.getElementById('revenueChart').getContext('2d');
const revenueChart = new Chart(revenueCtx, {
  type: 'bar',
  data: {
    labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
    datasets: [{
      label: 'Receita (R$)',
      data: [45000, 52000, 48000, 61000, 55000, 67000],
      backgroundColor: 'rgba(30, 64, 175, 0.8)',
      borderColor: '#1e40af',
      borderWidth: 1,
      borderRadius: 8
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: { display: false }
    },
    scales: {
      y: {
        beginAtZero: true,
        ticks: {
          callback: function (value) {
            return 'R$ ' + value.toLocaleString();
          }
        }
      }
    }
  }
});

// Animação do ícone de refresh
setInterval(() => {
  const refreshIcon = document.getElementById('refreshIcon');
  refreshIcon.style.transform = 'rotate(360deg)';
  setTimeout(() => {
    refreshIcon.style.transform = 'rotate(0deg)';
  }, 1000);
}, 10000);

// Animação dos números (contador)
function animateValue(id, start, end, duration) {
  const obj = document.getElementById(id);
  const range = end - start;
  const minTimer = 50;
  let stepTime = Math.abs(Math.floor(duration / range));
  stepTime = Math.max(stepTime, minTimer);

  const startTime = new Date().getTime();
  const endTime = startTime + duration;
  let timer;

  function run() {
    const now = new Date().getTime();
    const remaining = Math.max((endTime - now) / duration, 0);
    const value = Math.round(end - (remaining * range));
    obj.innerHTML = value;
    if (value === end) {
      clearInterval(timer);
    }
  }

  timer = setInterval(run, stepTime);
  run();
}

// Animações na carga da página
document.addEventListener('DOMContentLoaded', function () {
  animateValue('totalEstablishments', 0, 8, 2000);
  animateValue('totalParkingLots', 0, 24, 2000);

  // Para números com vírgula/pontos
  setTimeout(() => {
    document.getElementById('totalSpaces').innerHTML = '1,248';
    document.getElementById('occupancyRate').innerHTML = '73%';
  }, 2000);
});
</script>
{% endblock %}
